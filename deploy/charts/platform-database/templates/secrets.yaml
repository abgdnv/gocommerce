{{- range .Values.users }}
{{- $secretName := (printf "%s-%s" $.Values.clusterName (.name | replace "_" "-")) }}
{{- $secret := (lookup "v1" "Secret" $.Release.Namespace $secretName) }}
---
apiVersion: v1
kind: Secret
type: kubernetes.io/basic-auth
metadata:
  name: {{ $secretName }}
  labels:
    cnpg.io/reload: "true"
data:
  username: {{ .name | b64enc }}
  password: {{ if $secret }}{{ index $secret.data "password" }}{{ else }}{{ randAlphaNum 16 | b64enc }}{{ end }}
{{- end }}
